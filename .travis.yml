language: cpp
os: linux
dist: focal

addons:
  sonarcloud:
    organization: "utilforever-github"
    token:
      secure: "EprMsPM2snbWZKR27yU5S3nLwjms7919whZmU4w8MADM3x0d2HIsCkKHvoL3S6l0DdFIR8AJgCK2uZ2Q3UJDsRJGHwnu1KCFkgtXFhZUUcwHkW3ZD23rDQL1klR8vg1atr52nV8102hH6z4YLP+mqpTp3bOupIARqfpwkiOnIXp5QxWQdPgjliQGNgHmQL3dho4aOanpkTpuG3C8QtbqhBPQjwX9ReH7yzpYG0lik0lkzYdjle3+zbMvNF16KdK4Tl1HSSvlIsWNE4U/dbYubvqBske3U9w2n+RS4kgkKr/m1KTThFgjx2955bPjplSUYAz3z+AhFBQG0z27X+P/EtzmwBUHE29hceDWqEJhF6ZMmIyGLe0TRSauNmz/Ew9auVdc9bO2OKswhU0PFnblif1iFazNz4NP0mkvzwxbtApbK/ZdDJnQlmvDfe3FeBB0QDM7GhudKr0bm52n2YTLRNULLHh5FwNaSxjT6/nRJeHS2LTV8vhJiRT94+rm21e4xYxIlAvgu7OpV9VX4/DKKUhH1BiMOHzBfP5GrAhH5sdSw5qa6gkyX7227OMgEOVTnoo3XBhZyKLn3frTfe6ZgAeAomFo+6VauMFxHSkMC6mS2bm+OLilyJKOJhqODeFXS1O9s+09U4Lfw67Rn4HmgToqnvBHH8jk3lOpmSsbgBw="

script:
  # Install packages
  - sudo apt-get install -yq gcovr ggcov lcov curl
  # Configure build
  - mkdir build
  - cd build
  - cmake .. -DCMAKE_BUILD_TYPE=Debug -DBUILD_COVERAGE=ON
  # Wraps the compilation with the Build Wrapper to generate configuration
  # (used later by the SonarQube Scanner) into the "bw-output" folder
  - build-wrapper-linux-x86-64 --out-dir ../bw-output make all
  # Execute some tests
  - lcov --gcov-tool /usr/bin/gcov -c -i -d Tests/UnitTests -o base.info
  - bin/UnitTests
  - lcov --gcov-tool /usr/bin/gcov -c -d Tests/UnitTests -o test.info
  - lcov --gcov-tool /usr/bin/gcov -a base.info -a test.info -o coverage.info
  - lcov --gcov-tool /usr/bin/gcov -r coverage.info '*/Extensions/*' -o coverage.info
  - lcov --gcov-tool /usr/bin/gcov -r coverage.info '*/Includes/*' -o coverage.info
  - lcov --gcov-tool /usr/bin/gcov -r coverage.info '*/Libraries/*' -o coverage.info
  - lcov --gcov-tool /usr/bin/gcov -l coverage.info
  # And finally run the SonarQube analysis - read the "sonar-project.properties"
  # file to see the specific configuration
  - cd ..
  - sonar-scanner

cache:
  directories:
    - '$HOME/.sonar/cache'